{
  "id": "92ec09cf-4310-44eb-abd0-5051e1004d12",
  "prefix": "lock",
  "description": "dm_tran_locks",
  "body": "SELECT DISTINCT\r\n         AT.transaction_begin_time ,\r\n         DATEDIFF(mi , AT.transaction_begin_time , GETDATE()) AS LockTimeInMinutes ,\r\n         DATEDIFF(ss , AT.transaction_begin_time , GETDATE()) AS LockTimeInSecondes ,\r\n         L.request_session_id AS SPID ,\r\n         DB_NAME(L.resource_database_id) AS DatabaseName ,\r\n         O.name AS LockedObjectName , P.object_id AS LockedObjectId ,\r\n         L.resource_type AS LockedResource , L.request_mode AS LockType ,\r\n         ST.text AS SqlStatementText , ES.login_name AS LoginName ,\r\n         ES.host_name AS HostName ,\r\n         TST.is_user_transaction AS IsUserTransaction ,\r\n         AT.name AS TransactionName , CN.auth_scheme AS AuthenticationMethod ,\r\n         AT.transaction_id\r\nFROM     sys.dm_tran_locks L WITH ( NOLOCK )\r\n         INNER JOIN sys.partitions P WITH ( NOLOCK )\r\n         ON P.hobt_id = L.resource_associated_entity_id\r\n         INNER JOIN sys.objects O WITH ( NOLOCK )\r\n         ON O.object_id = P.object_id\r\n         INNER JOIN sys.dm_exec_sessions ES WITH ( NOLOCK )\r\n         ON ES.session_id = L.request_session_id\r\n         INNER JOIN sys.dm_tran_session_transactions TST WITH ( NOLOCK )\r\n         ON ES.session_id = TST.session_id\r\n         INNER JOIN sys.dm_tran_active_transactions AT WITH ( NOLOCK )\r\n         ON TST.transaction_id = AT.transaction_id\r\n         INNER JOIN sys.dm_exec_connections CN WITH ( NOLOCK )\r\n         ON CN.session_id = ES.session_id\r\n         CROSS APPLY sys.dm_exec_sql_text(CN.most_recent_sql_handle) AS ST\r\nWHERE    L.resource_database_id = DB_ID()\r\nORDER BY L.request_session_id"
}